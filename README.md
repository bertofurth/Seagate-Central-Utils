# Seagate-Central-Utils
Instructions for compiling and installing new and updated utilities 
for the Seagate Central NAS.

Most of the instructions in this project make use of the cross
compiler as generated by the Seagate-Central-Toolchain project
at

https://github.com/bertofurth/Seagate-Central-Toolchain

Many, but not all, of the tools in this project assume that the target
Seagate Central has an upgraded linux kernel as per the 
Seagate-Central-Slot-In-v5.x-Kernel project at

https://github.com/bertofurth/Seagate-Central-Slot-In-v5.x-Kernel

See the individual directories in this project to view instructions
specific for each tool

## Tools that require the new kernel

* syncthing - File syncronisation tool


## Tools that do not require the new kernel

* procps - Fully functional standard versions of top, ps, kill, etc


## Prerequisites
Unless otherwise noted the following preequisites apply to all of the
instructions in this project.

### su/root access on the Seagate Central.
Make sure that you can establish an ssh session to the Seagate Central
and that you can succesfully issue the **su** command to gain root
priviledges. Note that some later versions of Seagate Central firmware
deliberately disable su access by default.

If you do not have su access to the target Seagate Central then consider
following the "Firmware Upgrade" instructions in the 
**Seagate-Central-Samba** project at the link below which will
automatically re-enable su access as a result of the procedure.

https://github.com/bertofurth/Seagate-Central-Samba/

### /usr/local/... added to Seagate Central PATH
The instructions in this project are organized so that new software
will be installed on the Seagate Central under the "/usr/local" directory.
This is so that none of the original software utilities on the 
Seagate Central are overwritten. This makes it easy to revert back to the 
original software if the new versions are not working properly.

For this reason the, default PATH on the Seagate Central needs to be
updated to include the appropriate "/usr/local/..." subdirectories 
otherwise new utilities will need to be executed by specifying their
full location.

Changing the path can be done in a few ways. The easiest is to
edit the "/etc/login.defs" file on the Seagate Central with an editor
like "nano" or "vi" so that the ENV_SUPATH and ENV_PATH variables 
have the appropriate "/usr/local/..." directories listed first as 
follows

    ENV_SUPATH      PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
    ENV_PATH        PATH=/usr/local/bin:/bin:/usr/bin

Another option is to edit the ".profile" or another similar bash startup
file in the home directory of any user who will log in to the unit
and place the PATH additions there. For example

    PATH=/usr/local/sbin:/usr/local/bin:$PATH

### Know how to copy files between your host and the Seagate Central. 
Not only should you know how to transfer files to and from your 
Seagate Central NAS and the build host, ideally you'll know how
to transfer files **even if the samba service is not working**. I 
would suggest that if samba is not working to use FTP or SCP which
should both still work.

### Do not perform these procedures as the root user on the build machine
Some versions of the libraries being used in this procedure have flaws
that may cause the "make install" component of the build process try to 
overwrite parts of the building system's library directories.

For this reason it is **imperative** that you are not performing
these procedures as root on the build machine otherwise important 
components of your build system may be overwritten.

The only time during this procedure you should be acting as the 
root user on the build system is if you are deliberately installing 
new components on your build system to facilitate the building process. 

## Troubleshooting
Here are some issues commonly enocuntered when installing new
software.

### The old version of a tool is still being run
IF you are trying to run a new tool but the old version is still
running then the most likely explanation is that the PATH has not
been reconfigured properly or has not been given the opportunity 
to be applied.

Check that the PATH has been modified in the appropriate startup
files and that it lists "/usr/local/bin" and "/usr/local/sbin" before
any other directories in the PATH.

Make sure that after changing the PATH in your startup files that you 
log out of and then back into the ssh session in order for the changes 
to take effect.

Check the PATH by issuing the "echo $PATH" command. 

Use the "which file-name" command to display which version of a tool is 
being invoked. For example
  
    # which top
    /usr/local/bin/top
  
Make sure that the version under "/usr/local/bin" is being is invoked 
instead of the old version which is normally under "/usr/bin" or "/bin" .
   
Confirm that the new version can actually be run by specifying the full
directory location. For example

    # /usr/local/bin/top

Make sure that the new version of the tool has the executable file 
attribute. You may need to issue the "chmod 755 file-name" command 
to ensure that the file is able to be executed.

### terminals database is inaccessible
When trying to run a command that uses complicated screen interactions
such as a menu or interactive display, an error message similar to the 
following may appear

    terminals database is inaccessible
    
This may be because the terminal type you are using to access the Seagate
Central is not supported.

The limited range of terminal types the Seagate Central natively supports
is as follows.

    ansi, dumb, linux, rxvt, rxvt-unicode, screen, sun, vt100, vt102, 
    vt200, vt220, vt52, xterm, xterm-color, xterm-xfree86

The easiest thing to do is to manually set the terminal type to "linux"
which is one of the most commonly used terminal types.

     TERM=linux

This can be done automatically in a bash startup script.

Alternately, reconfigure your ssh client to emulate one of the above 
listed terminal types when connecting to the Seagate Central.

### Shared libraries
When trying to run new software an error similar to the following may
appear

    xxxx: error while loading shared libraries: libxxx.so.X: cannot open shared object file: No such file or directory

If this happens make sure to confirm that the required new shared libary
files were correctly transferred from the extracted software archive to
the /usr/local/lib directory on the Seagate Central.

Use the "ldd file-name" command to check which libaries are required by 
the program being executed and check that they are in place as per the 
output of the ldd command.

For example

    # ldd /usr/local/bin/top
        libprocps.so.8 => /usr/local/lib/libprocps.so.8 (0x355a0000)
        libncurses.so.5 => /usr/lib/libncurses.so.5 (0x355f0000)
        libdl.so.2 => /lib/libdl.so.2 (0x35640000)
        libc.so.6 => /lib/libc.so.6 (0x35670000)
        /lib/ld-linux.so.3 (0x35560000)

The "ldd -v" form of the command will give even more detailed information.

### Wrong binary format
When trying to run new software, errors similar to the following may
appear

    not a dynamic executable
    
    line 1: syntax error: ")" unexpected
    
The most likely cause of these kinds of errors is that the binaries that
have been installed have not been cross compiled for the Seagate Central
arm 32 architecture.

Confirm that when the sofware is being compiled that a cross compiler is
being used and not a native compiler that builds binaries for the 
build system itself.

    
