# README-procps.md
procps is a suite of tools including ps, top and kill that
view and manipulate system status. The versions natively
included in the Seagate Central are based on the busybox tool
and are therefore quite crippled and don't even use standard
command line parameters.

To build procps, it's necessary to use a cross compiler suitable
for arm 32. This procedure has been developed using the suite
generated by the Seagate-Central-Toolchain project as seen at

https://github.com/bertofurth/Seagate-Central-Toolchain

### Source code download and extraction
Gather the required source code for each component and save it
to the **src** subdirectory of the base working directory.

    cd src
    wget https://gitlab.com/procps-ng/procps/-/archive/v3.3.16/procps-v3.3.16.tar.bz2
    wget http://mirrors.kernel.org/gnu/ncurses/ncurses-6.2.tar.gz    

Extract each file with the **tar -xf** command.

    tar -xf procps-v3.3.16.tar.bz2
    tar -xf ncurses-6.2.tar.gz   

Here we show the versions of software used when generating this guide.
Unless otherwise noted these are the latest stable releases at the
time of writing. Hopefully later versions, or at least those with
the same major version numbers, will still work with this guide.

* procps-3.3.16
* ncurses-6.2
    
### Seagate Central libraries and headers
We need to copy over one specific library file from the Seagate
Central to the build host, namely "/usr/lib/libncurses.so.5.0.7", 
so that it can be linked to during the build process.

N.B. You may have already copied over all of the Seagate Central
libraries to the build host as part of the cross compililation 
procedure for other Seagate Central software. If that's the
case, then simply copy the relevant sub directory (normally 
"sc-libs") from that project to this one.

Create an appropriate sub directory under the base working 
directory to store the library in. By default we use the "sc-libs"
subdirectory to store Seagate Central libraries.

    mkdir -p sc-libs/usr/lib
    
In this example we copy the required library using the scp command. 
You will need to substitute your own username and NAS IP address.
After executing the scp command you'll be prompted for the 
password for that username on the Seagate Central. 

    scp admin@192.0.2.99:/usr/lib/libncurses.so.5.0.7 sc-libs/usr/lib/
       
### Customize the build scripts
You may need to edit the variables at the top of the **build-common**
file to suit your build environment.

These parameters are arranged roughly in order of their likelihood
of needing to be changed. The first two are the most important to get
right.

#### CROSS_COMPILE (Important)
This parameter sets the prefix name of the cross compiling toolkit.
This will likely be something like "arm-XXX-linux-gnueabi-" . 
Normally this will have a dash (-) at the end.

    CROSS_COMPILE=arm-sc-linux-gnueabi-
    
#### CROSS and TOOLS (Important)
The location of the root of the cross compiling tool suite on the 
compiling host (CROSS), and the location of the cross compiling 
binary executables such as gcc (TOOLS).

Make sure to use an absolute path and not the ~ or . symbols.

    CROSS=$HOME/Seagate-Central-Toolchain/cross
    TOOLS=$CROSS/tools/bin

#### J (Number of CPU threads) 
Set the number of threads to use when compiling. Generally set 
equal to or less than the number of CPU cores on the building machine. 
Set to 1 when troubleshooting.
    
    J=6

#### BUILDHOST_DEST (Unlikely to need changing)
The directory on the compiling host where binaries and other 
generated files will be temporarily installed before being copied 
to the Seagate Central.

This is different to PREFIX and EXEC_PREFIX (see below) which is where 
the generated files need to be located on the Seagate Central itself.

     BUILDHOST_DEST=$(pwd)/cross

#### PREFIX, EXEC_PREFIX (Unlikely to need changing)
The directories where the libraries (PREFIX) and executables
(EXEC_PREFIX) will be installed on the target device (i.e. on
the Seagate Central). These should probably be left as "/usr/local".

Note that is NOT the place where the resultant binaries and libraries 
will be temporarily copied to on the compiling host (see 
BUILDHOST_DEST).

     PREFIX=/usr/local
     
     EXEC_PREFIX=/usr/local

#### SEAGATE_LIBS_BASE (Unlikely to need changing)
Specify a directory containing the native library files as copied
from the Seagate Central. If this directory is changed then make
sure the step that downloads libraries from the Seagate Central
to the build host is modified accordingly.

     SEAGATE_LIBS_BASE=$(pwd)/sc-libs
     
### Run the build scripts in order
The build scripts are named in the numerical order that they need to be
executed. On the first run we suggest executing them individually to make
sure each one works.

    ./build-procps-01-ncurses-headers.sh
    ./build-procps-02-procps.sh
 
There is a script called **run_all_build.sh** that will execute all 
the individual build scripts in order however this is only recommended
once you are confident that the build will run without issue.

### Transfer cross compiled binaries to the Seagate Central
Once the binaries have been compiled, generate an archive that can
be transferred to the Segate Central.

    mv cross seagate-central-procps
    tar -caf seagate-central-procps.tar.gz seagate-central-procps

This archive can be copied to the Seagate Central in the same way that
other files are normally copied to the NAS. 

In the following example we use the scp command to transfer the archive.
You will need to substitute your own username and NAS IP address. After
executing the scp command you'll be prompted for the user's password.

    scp seagate-central-procps.tar.gz admin@192.0.2.99:
     
### Login to the Seagate Central
Establish an ssh session to the Seagate Central.

The commands after this point in the procedure must be executed with
root priviledges on the Seagate Central. This can be done by either
prepending **sudo** to each command or by issuing the **su** command
and becoming the root user.

### Extract the archive on the Seagate Central
Change to the directory where the archive has been copied to and
extract it as follows.

    tar -xvf seagate-central-procps.tar.gz
     
Note, you may get warning messages similar to the following but these
are safe to ignore.

    tar: warning: skipping header 'x'
     
A new directory containing the expanded archive will be created.
Change into this directory.

    cd seagate-central-procps

### Install the new procps software
The structure of files in the extracted archive should be such that
we can simply copy everything under the usr subdirectory straight
to the /usr directory of the Seagate Central.

Issue the following command from the extracted archive's base
directory

     cp -r -f usr/* /usr/
     
Finally perform a sanity check to make sure the new binaries are
executable by running the following command to check the version of
ps that has been installed.

     ps --version
 
The command should report that the tool is "from procps-ng" as opposed
to being "Busybox". Note that some recent versions of procps tools may
show the version number as UNKNOWN as per the following sample output

    ps from procps-ng UNKNOWN

The "UNKNOWN" string is a known issue in recent versions of procps and
is nothing to worry about. 
